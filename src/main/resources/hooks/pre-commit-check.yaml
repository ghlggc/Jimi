name: "pre-commit-check"
description: "Git æäº¤å‰è‡ªåŠ¨è¿è¡Œæµ‹è¯•"
enabled: true
priority: 100

trigger:
  type: "PRE_TOOL_CALL"
  tools:
    - "Bash"

execution:
  type: "script"
  script: |
    #!/bin/bash
    
    # æ£€æŸ¥æ˜¯å¦æ˜¯ git commit å‘½ä»¤
    if [[ "${TOOL_RESULT}" != *"git commit"* ]]; then
      exit 0
    fi
    
    echo "ğŸ” Git æäº¤å‰æ£€æŸ¥..."
    
    # è¿è¡Œæµ‹è¯•
    if [ -f "pom.xml" ]; then
      echo "ğŸ“¦ Maven é¡¹ç›®,è¿è¡Œæµ‹è¯•..."
      mvn test -q
      
      if [ $? -ne 0 ]; then
        echo "âŒ æµ‹è¯•å¤±è´¥,å·²é˜»æ­¢æäº¤"
        exit 1
      fi
    elif [ -f "build.gradle" ]; then
      echo "ğŸ“¦ Gradle é¡¹ç›®,è¿è¡Œæµ‹è¯•..."
      ./gradlew test
      
      if [ $? -ne 0 ]; then
        echo "âŒ æµ‹è¯•å¤±è´¥,å·²é˜»æ­¢æäº¤"
        exit 1
      fi
    fi
    
    echo "âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡"
  workingDir: "${JIMI_WORK_DIR}"
  timeout: 300

conditions:
  - type: "file_exists"
    path: ".git"
    description: "å¿…é¡»æ˜¯ Git ä»“åº“"
