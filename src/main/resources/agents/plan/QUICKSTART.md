# Plan Agent 快速开始

## 方式 1：从 Default Agent 委托

在与 Jimi 对话时，直接请求使用 Plan Agent：

```
用户：请使用 Plan-Agent 为实现用户权限管理系统制定详细的执行计划

Default Agent 会自动：
1. 调用 Task 工具委托给 Plan-Agent
2. Plan-Agent 开始分析和规划
3. 创建任务清单
4. 按计划执行并跟踪进度
```

## 方式 2：直接切换到 Plan Agent

使用命令切换 Agent：

```bash
# 启动 Jimi
jimi

# 切换到 Plan Agent
/agent plan

# 输入任务
请为重构订单模块制定详细的执行计划
```

## 典型对话示例

### 示例 1：功能开发

```
用户：请为实现一个支持多租户的权限管理系统制定执行计划

Plan-Agent：
我将分析任务并制定详细计划...

[步骤 1] 使用 Think 工具分析...
- 多租户架构设计要点
- 权限模型选择（RBAC/ABAC）
- 数据隔离策略
- 安全考虑

[步骤 2] 了解现有代码结构...
[使用 Glob 和 ReadFile]

[步骤 3] 创建任务清单...

📋 任务规划完成

总任务数：12 个
预估复杂度：复杂
关键风险点：
  - 租户数据隔离
  - 权限校验性能
  - 租户切换安全性

任务清单：
1. [Pending] 设计多租户数据模型
2. [Pending] 设计 RBAC 权限模型
3. [Pending] 实现租户上下文管理
4. [Pending] 实现权限注解和拦截器
5. [Pending] 实现角色和权限管理 API
6. [Pending] 实现用户权限查询优化
7. [Pending] 编写单元测试
8. [Pending] 编写集成测试
9. [Pending] 性能测试和优化
10. [Pending] 安全测试（权限绕过等）
11. [Pending] 编写使用文档
12. [Pending] 代码审查和优化

准备开始执行...

[步骤 4] 执行任务 1-2...
[委托 Design-Agent]
✅ 任务 1 已完成：设计多租户数据模型
✅ 任务 2 已完成：设计 RBAC 权限模型

[步骤 5] 执行任务 3-6...
[委托 Code-Agent]
🔄 正在执行任务 3：实现租户上下文管理
...
```

### 示例 2：Bug 修复

```
用户：订单支付模块在高并发下偶发重复扣款，请制定排查和修复计划

Plan-Agent：
我将深入分析这个并发问题并制定系统性的排查修复计划...

[步骤 1] 深度分析问题...
[使用 Think]

可能原因分析：
1. 幂等性控制缺失
2. 分布式锁实现问题
3. 事务隔离级别不当
4. 缓存状态不一致
5. 重试机制导致

排查策略：
- 复现问题场景
- 分析日志和调用链
- 检查锁和事务代码
- 压力测试验证

[步骤 2] 阅读支付相关代码...
[使用 ReadFile 和 Grep]

[步骤 3] 创建排查修复计划...

📋 排查修复计划

任务清单：
1. [Pending] 搭建本地并发测试环境
2. [Pending] 复现重复扣款问题
3. [Pending] 分析支付流程调用链
4. [Pending] 检查幂等性实现
5. [Pending] 检查分布式锁代码
6. [Pending] 检查数据库事务隔离级别
7. [Pending] 定位根本原因
8. [Pending] 设计修复方案
9. [Pending] 实现修复代码
10. [Pending] 编写并发测试用例
11. [Pending] 压力测试验证
12. [Pending] 代码审查

开始排查...
[委托 Debug-Agent 和 Test-Agent]
```

### 示例 3：系统重构

```
用户：请为将用户服务从单体拆分为微服务制定迁移计划

Plan-Agent：
这是一个复杂的架构迁移任务，我将制定分阶段的详细计划...

[步骤 1-2] 深度分析和评估...

现状分析：
- 用户服务当前承载：认证、用户管理、权限、个人资料
- 依赖关系：订单服务、支付服务都依赖用户服务
- 数据库表：users, roles, permissions, user_profiles

迁移策略：
- 采用陌生人模式（Strangler Pattern）
- 分阶段迁移，保证线上稳定
- 数据库渐进式拆分

[步骤 3] 创建迁移计划...

📋 微服务迁移计划

总任务数：20 个
预估周期：3-4 周
风险等级：高

=== 阶段 1：准备工作（Week 1）===
1. [Pending] 梳理用户服务 API 清单
2. [Pending] 分析服务调用依赖关系
3. [Pending] 设计微服务接口契约
4. [Pending] 设计数据库拆分方案
5. [Pending] 准备服务注册与发现

=== 阶段 2：服务构建（Week 2）===
6. [Pending] 创建用户微服务脚手架
7. [Pending] 迁移用户管理业务逻辑
8. [Pending] 实现服务间通信（Feign/gRPC）
9. [Pending] 实现配置中心集成
10. [Pending] 实现分布式追踪

=== 阶段 3：数据迁移（Week 2-3）===
11. [Pending] 准备数据同步方案
12. [Pending] 执行数据库拆分
13. [Pending] 验证数据完整性
14. [Pending] 配置双写机制

=== 阶段 4：测试验证（Week 3）===
15. [Pending] 单元测试
16. [Pending] 集成测试
17. [Pending] 性能基准测试
18. [Pending] 灰度发布测试

=== 阶段 5：上线部署（Week 4）===
19. [Pending] 准备回滚方案
20. [Pending] 生产环境灰度发布
21. [Pending] 监控观察和优化

关键风险点：
⚠️ 数据一致性保证
⚠️ 服务降级策略
⚠️ 流量切换平滑性

准备开始执行第一阶段...
```

## 进度查看

在执行过程中，你可以随时查看进度：

```
📊 当前进度：5/12 完成

已完成：
✅ 1. 设计多租户数据模型
✅ 2. 设计 RBAC 权限模型
✅ 3. 实现租户上下文管理
✅ 4. 实现权限注解和拦截器
✅ 5. 实现角色和权限管理 API

执行中：
🔄 6. 实现用户权限查询优化

待执行：
⏳ 7. 编写单元测试
⏳ 8. 编写集成测试
...
```

## 计划调整示例

如果执行中发现新问题：

```
用户：在实现过程中发现需要支持动态权限配置

Plan-Agent：
了解，我将调整计划以支持这个新需求...

[使用 Think 分析影响]
[使用 SetTodoList 更新计划]

📋 计划已更新

新增任务：
+ 6.1 [Pending] 设计动态权限配置表结构
+ 6.2 [Pending] 实现权限配置热加载
+ 6.3 [Pending] 实现权限配置管理界面

调整后总任务数：15 个
```

## 提示

1. **给予充分时间**：等待 Plan Agent 完成分析和规划
2. **提供足够信息**：说明技术栈、约束条件、预期目标
3. **信任专业判断**：Plan Agent 会根据最佳实践制定计划
4. **及时反馈**：发现问题或新需求及时告知
5. **关注进度**：通过任务状态了解执行情况

## 下一步

查看完整文档：[README.md](README.md)
